volumes:
  logs:
    driver: local
  db:
    driver: local
networks:
  azimut-network:
services:
  # database
  couchdb:
    image: couchdb:3.5.0
    restart: always
    env_file:
      #- .env.dist
      - .env
    environment:
      - AZIMUT_COUCHDB_HOST
      - "COUCHDB_USER=${AZIMUT_COUCHDB_USER:-admin}"
      - "COUCHDB_PASSWORD=${AZIMUT_COUCHDB_PASSWORD:-password}"
      - "COUCHDB_SECRET=${COUCHDB_SECRET:-123456}"
    volumes:
      - db:/opt/couchdb/data
    ports:
      - '5984:5984'
      - '4369:4369'
      - '9100:9100'

  # Angular + fastify running on node.js
  server:
    build:
      context: .
      args:
        NG_ENV: local
    volumes:
      - .:/usr/src/azimut
      - /usr/src/azimut/node_modules
    restart: always
    links:
      - couchdb
    ports:
      - 4000:4000
    environment:
      - NODE_ENV=development
      - AZIMUT_COUCHDB_HOST
      - AZIMUT_FRONT_URL

  tests:
    image: mcr.microsoft.com/playwright:v1.53.0-noble
    command: npx -y playwright@1.53.0 run-server --port 3000 --host 0.0.0.0
    ports:
      - 3000:3000

