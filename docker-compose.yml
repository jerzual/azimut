
volumes:
  db:
    driver: local
networks:
  azimut-network:
  playwright-network:
services:
  # main database
  couchdb:
    image: couchdb:2.3.1
    restart: always
    env_file:
      #- .env.dist
      - .env
    environment:
      - AZIMUT_COUCHDB_HOST
      - COUCHDB_USER:AZIMUT_COUCHDB_USER
      - COUCHDB_PASSWORD:AZIMUT_COUCHDB_PASSWORD
    volumes:
      - db:/opt/couchdb/data
    ports:
      - 5984:5984
    networks:
      - azimut-network

  # Angular + express running on node
  server:
    build:
      context: .
      target: run
      args:
        NG_ENV: local
    restart: always
    links:
      - couchdb
    ports:
      - 4000:4000
      - 4100:4100
    environment:
      - NODE_ENV=development
      - AZIMUT_COUCHDB_HOST
      - AZIMUT_FRONT_URL
    networks:
      - azimut-network
      - playwright-network

  # end to end tests with playwright
  e2e:
    build:
      context: .
      target: e2e
    links:
      - server
    environment:
      - AZIMUT_FRONT_URL=http://server:4000
    ports:
      - 9323:9323
    volumes:
      - ./playwright-reports:/app/playwright-reports
    networks:
      - playwright-network

